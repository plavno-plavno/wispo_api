= Wispo API
:toc:

== How to start

.Start for development and debugging:
[source,shell,linenum]
----
$ cd wispo_api && make run
----

.Start in Docker Compose:
[source,shell,linenum]
----
$ docker compose -f docker-compose.yaml up
----

== Register Phone

.JSON-RPC 2.0 Request:
[source,shell,linenum]
----
$ curl -X POST http://localhost:8989/jsonrpc/ \
-H 'Content-Type: application/json' \
-d '{
  "jsonrpc": "2.0",
  "method": "phones.register",
  "params": {
    "phone": "+3801234567890"
  },
  "id": 1
}'
----

.JSON-RPC 2.0 Response:
[source,json,linenum]
----
{
  "jsonrpc": "2.0",
  "result": {
    "phone": "+3801234567890",
    "code": [2,7,0,3]
  },
  "id": 1
}
----

.HTTP REST API Request:
[source,shell,linenum]
----
$ curl -X POST http://127.0.0.1:8989/rest/1/phones/register \
-H 'Content-Type: application/json' \
-d '
{
  "phone": "+3801234567890",
  "id": 1
}'
----

.HTTP REST API Response:
[source,shell,linenum]
----
HTTP/1.1 200 OK
content-length: 69
content-type: application/json
date: Mon, 06 Jan 2025 02:20:12 GMT
server: Cowboy

{
  "phone": "+3801234567890",
  "code": [2,7,0,3],
  "id": 1
}'
----

== Confirm Phone

.JSON-RPC 2.0 Request:
[source,shell,linenum]
----
$ curl -X POST http://localhost:8989/jsonrpc/ \
-H 'Content-Type: application/json' \
-d '{
  "jsonrpc": "2.0",
  "method": "phones.confirm",
  "params": {
    "phone": "+3801234567890",
    "code": [1,2,3,4]
  },
  "id": 1
}'
----

.JSON-RPC 2.0 Response:
[source,json,linenum]
----
{
  "jsonrpc": "2.0",
  "result": {
    "access_jwt": "...",
    "refresh_jwt": "..."
  },
  "id": 1
}
----

.HTTP REST API Request:
[source,shell,linenum]
----
$ curl -X POST http://127.0.0.1:8989/rest/1/phones/confirm \
-H 'Content-Type: application/json' \
-d '
{
  "phone": "+3801234567890",
  "code": [1,2,3,4],
  "id": 1
}'
----

.HTTP REST API Response:
[source,shell,linenum]
----
HTTP/1.1 200 OK
content-length: 69
content-type: application/json
date: Mon, 06 Jan 2025 02:20:12 GMT
server: Cowboy

{
  "access_jwt": "...",
  "refresh_jwt": "...",
  "id": 1
}'
----

== Is Known Phone

.JSON-RPC 2.0 Request:
[source,shell,linenum]
----
$ curl -X POST http://localhost:8989/jsonrpc/ \
-H 'Content-Type: application/json' \
-d '{
  "jsonrpc": "2.0",
  "method": "phones.is_known",
  "params": {
    "phone": "+3801234567890"
  },
  "id": 1
}'
----

.JSON-RPC 2.0 Response:
[source,json,linenums]
----
{
  "jsonrpc": "2.0",
  "result": true,
  "id": 1
}
----

== Is Confirmed Phone

.JSON-RPC 2.0 Request:
[source,shell,linenum]
----
$ curl -X POST http://localhost:8989/jsonrpc/ \
-H 'Content-Type: application/json' \
-d '{
  "jsonrpc": "2.0",
  "method": "phones.is_confirmed",
  "params": {
    "phone": "+3801234567890"
  },
  "id": 1
}'
----

.JSON-RPC 2.0 Response:
[source,json,linenums]
----
{
  "jsonrpc": "2.0",
  "result": true,
  "id": 1
}
----

== Sync Contacts List

.JSON-RPC 2.0 Request:
[source,shell,linenum]
----
$ curl -X POST http://localhost:8989/jsonrpc/ \
-H 'Content-Type: application/json' \
-d '{
  "jsonrpc": "2.0",
  "method": "contacts.sync",
  "params": {
    "phone": "+3801234567890",
    "contacts": [...]
  },
  "id": 1
}'
----

.JSON-RPC 2.0 Response:
[source,json,linenum]
----
{
  "jsonrpc": "2.0",
  "result": "ok",
  "id": 1
}
----

== Remove Synced Contacts List

.JSON-RPC 2.0 Request:
[source,json,linenum]
----
{
  "jsonrpc": "2.0",
  "method": "contacts.remove_synced",
  "params": {},
  "id": 1
}
----

.JSON-RPC 2.0 Response:
[source,json,linenum]
----
{
  "jsonrpc": "2.0",
  "result": "ok",
  "id": 1
}
----